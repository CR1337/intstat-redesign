#!/bin/bash
set -euo pipefail
trap 'echo "Error on line $LINENO. Exit code: $?"; exit 1' ERR

if bin/check-running; then
    echo "Stoppe container..."
    bin/stop
fi

if bin/check-exists; then
    echo "Entferne image..."
    bin/remove
fi

echo "Erstelle container..."
bin/build

echo "Erzeuge SQL..."
bin/make

echo "Starte container..."
bin/run
bin/wait-for-mysql

for arg in "$@"; do
  if [ "$arg" = "-t" ]; then
    echo "Starte tests..."
    bin/test
    break
  fi
done
